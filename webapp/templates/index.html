<!DOCTYPE html>
<html>
   <head>
      <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet" />
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"  integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="  crossorigin=""/> 
      <link href="../static/main.css" rel="stylesheet" />
      <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
      <title>Livability</title>
   </head>
   <body>
    <header class="header">
        <div>
            <div class="head-title">Neighborhood Livability</div>
        </div>
    </header>
    <div id="map-container"></div>

    <main>
        <div class="main-flex">
                    
            <!-- search --> 
            

        </div>
    </main>
   </body>
   <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

   <script>
       const map = L.map('map-container',{
           center: [37.3382, -121.8863],
           zoom: 10.75,
           zoomSnap: 0,
           zoomDelta: 0.25,
           zoomControl: false,
           dragging: false,
           scrollWheelZoom: false,
           doubleClickZoom: false,
           boxZoom: false,
           keyboard: false,
           touchZoom: false,
       });

       L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
       }).addTo(map);

       const apiUrl = "https://geo.sanjoseca.gov/server/rest/services/OPN/OPN_OpenDataService/MapServer/549/query?where=1%3D1&outFields=*&outSR=4326&f=json";

       // Fetch data from api 
       fetch(apiUrl)
           .then(response => response.json())
           .then(data => {
               // add polygons
               data.features.forEach(feature => {
                    const coords = feature.geometry.rings[0].map(coord => [coord[1], coord[0]]);
                    const name = feature.attributes.NAME;

                    var polygon = L.polygon(coords, {
                        color: 'blue',
                        fillOpacity: 0.5,
                    }).addTo(map)

                    polygon.on('click', function () {
                        window.location.href = `{{url_for('routes.neighborhood')}}?nName=${encodeURIComponent(name)}`;
                    });
                   // L.marker(coords[0])
                //    .bindPopup(`<strong>${name}</strong>`);
               });
           })
           .catch(error => console.error('Error fetching data:', error));
   </script>
   <script src="main.js"></script>
</html>
